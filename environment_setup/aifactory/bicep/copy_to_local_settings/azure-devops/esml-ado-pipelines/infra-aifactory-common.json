{"source":2,"revision":3,"description":null,"createdBy":{"displayName":"Joakim Åström","url":"https://spsprodweu4.vssps.visualstudio.com/Ae8dda09f-c2b4-4692-b8a9-19b9ca10e69b/_apis/Identities/557c9a45-3a85-6eff-ab88-9f8a5f00114e","_links":{"avatar":{"href":"https://dev.azure.com/ESML_AI_Factory/_apis/GraphProfile/MemberAvatars/aad.NTU3YzlhNDUtM2E4NS03ZWZmLWFiODgtOWY4YTVmMDAxMTRl"}},"id":"557c9a45-3a85-6eff-ab88-9f8a5f00114e","uniqueName":"ESML_AI_Factory@microsoft.com","imageUrl":"https://dev.azure.com/ESML_AI_Factory/_apis/GraphProfile/MemberAvatars/aad.NTU3YzlhNDUtM2E4NS03ZWZmLWFiODgtOWY4YTVmMDAxMTRl","descriptor":"aad.NTU3YzlhNDUtM2E4NS03ZWZmLWFiODgtOWY4YTVmMDAxMTRl"},"createdOn":"2024-09-12T10:41:37.557Z","modifiedBy":{"displayName":"Joakim Åström","url":"https://spsprodweu4.vssps.visualstudio.com/Ae8dda09f-c2b4-4692-b8a9-19b9ca10e69b/_apis/Identities/557c9a45-3a85-6eff-ab88-9f8a5f00114e","_links":{"avatar":{"href":"https://dev.azure.com/ESML_AI_Factory/_apis/GraphProfile/MemberAvatars/aad.NTU3YzlhNDUtM2E4NS03ZWZmLWFiODgtOWY4YTVmMDAxMTRl"}},"id":"557c9a45-3a85-6eff-ab88-9f8a5f00114e","uniqueName":"ESML_AI_Factory@microsoft.com","imageUrl":"https://dev.azure.com/ESML_AI_Factory/_apis/GraphProfile/MemberAvatars/aad.NTU3YzlhNDUtM2E4NS03ZWZmLWFiODgtOWY4YTVmMDAxMTRl","descriptor":"aad.NTU3YzlhNDUtM2E4NS03ZWZmLWFiODgtOWY4YTVmMDAxMTRl"},"modifiedOn":"2024-09-12T10:44:15.270Z","isDeleted":false,"isDisabled":false,"variables":{"admin_input_keyvault_name":{"value":"kv-seeding-sdc-001"},"admin_input_keyvault_rg":{"value":"rg-kv-seeding-sdc-001"},"admin_input_keyvault_subscription":{"value":"abc124"},"admin_location":{"value":"swedencentral"},"admin_locationSuffix":{"value":"sdc"},"aifactorySuffixRG":{"value":"-00"},"aiResourceSuffix":{"value":"-001"},"tag_cost_center_override":{"value":"123456"},"tag_project_owner_override":{"value":"BCIO Superman"},"tag_resource_managed_by_override":{"value":"null"},"technical_admins_ad_object_id":{"value":"abc124,def999"},"technical_admins_bastion_IP_whitelist":{"value":"XX.XXX.XXX.XX"},"technical_admins_email":{"value":"user1@abc.com, user@sbc.com"}},"variableGroups":[],"environments":[{"id":92,"name":"esml-common-dev","rank":1,"owner":{"displayName":"Joakim Åström","url":"https://spsprodweu4.vssps.visualstudio.com/Ae8dda09f-c2b4-4692-b8a9-19b9ca10e69b/_apis/Identities/557c9a45-3a85-6eff-ab88-9f8a5f00114e","_links":{"avatar":{"href":"https://dev.azure.com/ESML_AI_Factory/_apis/GraphProfile/MemberAvatars/aad.NTU3YzlhNDUtM2E4NS03ZWZmLWFiODgtOWY4YTVmMDAxMTRl"}},"id":"557c9a45-3a85-6eff-ab88-9f8a5f00114e","uniqueName":"ESML_AI_Factory@microsoft.com","imageUrl":"https://dev.azure.com/ESML_AI_Factory/_apis/GraphProfile/MemberAvatars/aad.NTU3YzlhNDUtM2E4NS03ZWZmLWFiODgtOWY4YTVmMDAxMTRl","descriptor":"aad.NTU3YzlhNDUtM2E4NS03ZWZmLWFiODgtOWY4YTVmMDAxMTRl"},"variables":{"cidr_range":{"value":"17"},"dev_test_prod":{"value":"dev"},"dev_test_prod_sub_id":{"value":"abc124"}},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":278}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":283},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":284}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"windows-2022"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":92,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent job","refName":null,"workflowTasks":[{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"11-Common RG and RBAC","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"47b43cde-c003-4a0d-8ad1-40d4050d326e","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"az deployment sub create \\\n--name \"esml-cmn-$(dev_test_prod)-$(admin_locationSuffix)-$(aifactorySuffixRG)-DeplRG\" \\\n--subscription \"$(dev_test_prod_sub_id)\" \\\n--location \"$(admin_location)\" \\\n--template-file \"esml-common\\main\\11-rgCommon.bicep\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\11-esml-globals-11_13.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-1.json\" \\\n--parameters locationSuffix=\"$(admin_locationSuffix)\" \\\n--parameters location=\"$(admin_location)\" \\\n--parameters env=\"$(dev_test_prod)\" \\\n--parameters aifactorySuffixRG=\"$(aifactorySuffixRG)\" \\\n--parameters technicalAdminsObjectID=\"$(technical_admins_ad_object_id)\" \\\n--parameters technicalAdminsEmail=\"$(technical_admins_email)\"","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"$(System.DefaultWorkingDirectory)/_esml-aifactory/azure-enterprise-scale-ml/environment_setup/aifactory/bicep","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false","visibleAzLogin":"true","keepAzSessionActive":"false"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"12-Common-Networking","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"47b43cde-c003-4a0d-8ad1-40d4050d326e","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"az deployment sub create \\\n--name \"esml-cmn$(dev_test_prod)-$(aifactorySuffixRG)-$(aiResourceSuffix)Subnets\" \\\n--subscription \"$(dev_test_prod_sub_id)\" \\\n--location \"$(admin_location)\" \\\n--template-file \"esml-common\\main\\12-networkCommon.bicep\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-1.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-2-12_13_21_22.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-3-12_13.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-override.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\12-esml-cmn-parameters.json\" \\\n--parameters locationSuffix=\"$(admin_locationSuffix)\" \\\n--parameters location=\"$(admin_location)\" \\\n--parameters env=\"$(dev_test_prod)\" \\\n--parameters cidr_range=\"$(cidr_range)\" \\\n--parameters aifactorySuffixRG=\"$(aifactorySuffixRG)\" \\\n--parameters commonResourceSuffix=\"$(aiResourceSuffix)\" \\\n--parameters IPwhiteList=\"$(technical_admins_bastion_IP_whitelist)\"\n","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"$(System.DefaultWorkingDirectory)/_esml-aifactory/azure-enterprise-scale-ml/environment_setup/aifactory/bicep","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false","visibleAzLogin":"true","keepAzSessionActive":"false"}},{"environment":{},"taskId":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","version":"2.*","name":"31_Show input parameter","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"script":"echo \"parameters\"\ntype \"..\\..\\..\\..\\aifactory\\parameters\\13-esml-cmn-parameters.json\"\necho \"$(dev_test_prod)\"","workingDirectory":"$(System.DefaultWorkingDirectory)/_esml-aifactory/azure-enterprise-scale-ml/environment_setup/aifactory/bicep","failOnStderr":"false"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"13-Deploy resources ","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"47b43cde-c003-4a0d-8ad1-40d4050d326e","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"az deployment sub create \\\n--name \"esml-cmn-$(dev_test_prod)-$(admin_locationSuffix)-$(aifactorySuffixRG)-$(aiResourceSuffix)-DeplRes\" \\\n--subscription \"$(dev_test_prod_sub_id)\" \\\n--location \"$(admin_location)\" \\\n--template-file \"esml-common\\main\\13-rgLevel.bicep\" \\\n--parameters adminPassword=\"$(date +%s | sha256sum | base64 | head -c 32 ; echo)\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-1.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-2-12_13_21_22.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-3-12_13.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-4-13_21_22.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-5-13_23.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-override.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\11-esml-globals-11_13.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\13-esml-cmn-parameters.json\" \\\n--parameters locationSuffix=\"$(admin_locationSuffix)\" \\\n--parameters location=\"$(admin_location)\" \\\n--parameters env=\"$(dev_test_prod)\" \\\n--parameters aifactorySuffixRG=\"$(aifactorySuffixRG)\" \\\n--parameters resourceSuffix=\"$(aiResourceSuffix)\" \\\n--parameters technicalAdminsObjectID=\"$(technical_admins_ad_object_id)\" \\\n--parameters technicalAdminsEmail=\"$(technical_admins_email)\" \\\n--parameters IPwhiteList=\"$(technical_admins_bastion_IP_whitelist)\" \\\n--parameters inputKeyvaultSubscription=\"$(admin_input_keyvault_subscription)\" \\\n--parameters inputKeyvaultResourcegroup=\"$(admin_input_keyvault_rg)\" \\\n--parameters inputKeyvault=\"$(admin_input_keyvault_name)\"","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"$(System.DefaultWorkingDirectory)/_esml-aifactory/azure-enterprise-scale-ml/environment_setup/aifactory/bicep","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false","visibleAzLogin":"true","keepAzSessionActive":"false"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":0,"url":"https://vsrm.dev.azure.com/ESML_AI_Factory/07da37fe-9071-4440-9127-f52f859d3062/_apis/Release/releases/0","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{"BoardsEnvironmentType":{"$type":"System.String","$value":"unmapped"},"LinkBoardsWorkItems":{"$type":"System.String","$value":"False"}},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://vsrm.dev.azure.com/ESML_AI_Factory/_apis/public/Release/badge/07da37fe-9071-4440-9127-f52f859d3062/34/92"},{"id":93,"name":"esml-common-test","rank":2,"owner":{"displayName":"Joakim Åström","url":"https://spsprodweu4.vssps.visualstudio.com/Ae8dda09f-c2b4-4692-b8a9-19b9ca10e69b/_apis/Identities/557c9a45-3a85-6eff-ab88-9f8a5f00114e","_links":{"avatar":{"href":"https://dev.azure.com/ESML_AI_Factory/_apis/GraphProfile/MemberAvatars/aad.NTU3YzlhNDUtM2E4NS03ZWZmLWFiODgtOWY4YTVmMDAxMTRl"}},"id":"557c9a45-3a85-6eff-ab88-9f8a5f00114e","uniqueName":"ESML_AI_Factory@microsoft.com","imageUrl":"https://dev.azure.com/ESML_AI_Factory/_apis/GraphProfile/MemberAvatars/aad.NTU3YzlhNDUtM2E4NS03ZWZmLWFiODgtOWY4YTVmMDAxMTRl","descriptor":"aad.NTU3YzlhNDUtM2E4NS03ZWZmLWFiODgtOWY4YTVmMDAxMTRl"},"variables":{"cidr_range":{"value":"18"},"dev_test_prod":{"value":"test"},"dev_test_prod_sub_id":{"value":"abc124"}},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":279}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":282},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":285}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"windows-2022"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":92,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent job","refName":null,"workflowTasks":[{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"10_Generate Rbac parameters","refName":"","enabled":false,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"1d155b9e-8948-402f-ae7b-d4de86b94c79","scriptType":"pscore","scriptLocation":"scriptPath","scriptPath":"$(System.DefaultWorkingDirectory)/_esml-aifactory/azure-enterprise-scale-ml/environment_setup/aifactory/bicep/scripts/generateUserParameters.ps1","inlineScript":"","scriptArguments":"-armParameters \"../parameters.json\" -filePath \"..\" -spObjId \"$(esml-common-bicep-sp-id)\" -spSecret \"$(esml-common-bicep-sp-secret)\"  -useServicePrincipal ","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"$(System.DefaultWorkingDirectory)/_esml-aifactory/azure-enterprise-scale-ml/environment_setup/aifactory/bicep/scripts","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false","visibleAzLogin":"true","keepAzSessionActive":"false"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"11-Common RG and RBAC","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"47b43cde-c003-4a0d-8ad1-40d4050d326e","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"az deployment sub create \\\n--name \"esml-cmn-$(dev_test_prod)-$(admin_locationSuffix)-$(aifactorySuffixRG)-DeplRG\" \\\n--subscription \"$(dev_test_prod_sub_id)\" \\\n--location \"$(admin_location)\" \\\n--template-file \"esml-common\\main\\11-rgCommon.bicep\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\11-esml-globals-11_13.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-1.json\" \\\n--parameters locationSuffix=\"$(admin_locationSuffix)\" \\\n--parameters location=\"$(admin_location)\" \\\n--parameters env=\"$(dev_test_prod)\" \\\n--parameters aifactorySuffixRG=\"$(aifactorySuffixRG)\" \\\n--parameters technicalAdminsObjectID=\"$(technical_admins_ad_object_id)\" \\\n--parameters technicalAdminsEmail=\"$(technical_admins_email)\"","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"$(System.DefaultWorkingDirectory)/_esml-aifactory/azure-enterprise-scale-ml/environment_setup/aifactory/bicep","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false","visibleAzLogin":"true","keepAzSessionActive":"false"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"12-Common-Networking","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"47b43cde-c003-4a0d-8ad1-40d4050d326e","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"az deployment sub create \\\n--name \"esml-cmn$(dev_test_prod)-$(aifactorySuffixRG)-$(aiResourceSuffix)Subnets\" \\\n--subscription \"$(dev_test_prod_sub_id)\" \\\n--location \"$(admin_location)\" \\\n--template-file \"esml-common\\main\\12-networkCommon.bicep\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-1.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-2-12_13_21_22.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-3-12_13.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-override.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\12-esml-cmn-parameters.json\" \\\n--parameters locationSuffix=\"$(admin_locationSuffix)\" \\\n--parameters location=\"$(admin_location)\" \\\n--parameters env=\"$(dev_test_prod)\" \\\n--parameters cidr_range=\"$(cidr_range)\" \\\n--parameters aifactorySuffixRG=\"$(aifactorySuffixRG)\" \\\n--parameters commonResourceSuffix=\"$(aiResourceSuffix)\" \\\n--parameters IPwhiteList=\"$(technical_admins_bastion_IP_whitelist)\"\n","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"$(System.DefaultWorkingDirectory)/_esml-aifactory/azure-enterprise-scale-ml/environment_setup/aifactory/bicep","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false","visibleAzLogin":"true","keepAzSessionActive":"false"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"30_Sleep for 1 minute","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"write-host \"Waiting for subnets to fully register to subscription\"\nStart-Sleep 60","errorActionPreference":"stop","warningPreference":"default","informationPreference":"default","verbosePreference":"default","debugPreference":"default","progressPreference":"silentlyContinue","failOnStderr":"false","showWarnings":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":"","runScriptInSeparateScope":"false"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"13-Deploy resources ","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"47b43cde-c003-4a0d-8ad1-40d4050d326e","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"az deployment sub create \\\n--name \"esml-cmn-$(dev_test_prod)-$(admin_locationSuffix)-$(aifactorySuffixRG)-$(aiResourceSuffix)-DeplRes\" \\\n--subscription \"$(dev_test_prod_sub_id)\" \\\n--location \"$(admin_location)\" \\\n--template-file \"esml-common\\main\\13-rgLevel.bicep\" \\\n--parameters adminPassword=\"$(date +%s | sha256sum | base64 | head -c 32 ; echo)\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-1.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-2-12_13_21_22.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-3-12_13.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-4-13_21_22.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-5-13_23.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-override.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\11-esml-globals-11_13.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\13-esml-cmn-parameters.json\" \\\n--parameters locationSuffix=\"$(admin_locationSuffix)\" \\\n--parameters location=\"$(admin_location)\" \\\n--parameters env=\"$(dev_test_prod)\" \\\n--parameters aifactorySuffixRG=\"$(aifactorySuffixRG)\" \\\n--parameters resourceSuffix=\"$(aiResourceSuffix)\" \\\n--parameters technicalAdminsObjectID=\"$(technical_admins_ad_object_id)\" \\\n--parameters technicalAdminsEmail=\"$(technical_admins_email)\" \\\n--parameters IPwhiteList=\"$(technical_admins_bastion_IP_whitelist)\" \\\n--parameters inputKeyvaultSubscription=\"$(admin_input_keyvault_subscription)\" \\\n--parameters inputKeyvaultResourcegroup=\"$(admin_input_keyvault_rg)\" \\\n--parameters inputKeyvault=\"$(admin_input_keyvault_name)\"","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"$(System.DefaultWorkingDirectory)/_esml-aifactory/azure-enterprise-scale-ml/environment_setup/aifactory/bicep","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false","visibleAzLogin":"true","keepAzSessionActive":"false"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":0,"url":"https://vsrm.dev.azure.com/ESML_AI_Factory/07da37fe-9071-4440-9127-f52f859d3062/_apis/Release/releases/0","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{"BoardsEnvironmentType":{"$type":"System.String","$value":"unmapped"},"LinkBoardsWorkItems":{"$type":"System.String","$value":"False"}},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://vsrm.dev.azure.com/ESML_AI_Factory/_apis/public/Release/badge/07da37fe-9071-4440-9127-f52f859d3062/34/93"},{"id":94,"name":"esml-common-prod","rank":3,"owner":{"displayName":"Joakim Åström","url":"https://spsprodweu4.vssps.visualstudio.com/Ae8dda09f-c2b4-4692-b8a9-19b9ca10e69b/_apis/Identities/557c9a45-3a85-6eff-ab88-9f8a5f00114e","_links":{"avatar":{"href":"https://dev.azure.com/ESML_AI_Factory/_apis/GraphProfile/MemberAvatars/aad.NTU3YzlhNDUtM2E4NS03ZWZmLWFiODgtOWY4YTVmMDAxMTRl"}},"id":"557c9a45-3a85-6eff-ab88-9f8a5f00114e","uniqueName":"ESML_AI_Factory@microsoft.com","imageUrl":"https://dev.azure.com/ESML_AI_Factory/_apis/GraphProfile/MemberAvatars/aad.NTU3YzlhNDUtM2E4NS03ZWZmLWFiODgtOWY4YTVmMDAxMTRl","descriptor":"aad.NTU3YzlhNDUtM2E4NS03ZWZmLWFiODgtOWY4YTVmMDAxMTRl"},"variables":{"cidr_range":{"value":"19"},"dev_test_prod":{"value":"prod"},"dev_test_prod_sub_id":{"value":"abc124"}},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":280}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":281},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":286}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"windows-2022"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":92,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent job","refName":null,"workflowTasks":[{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"11-Common RG and RBAC","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"47b43cde-c003-4a0d-8ad1-40d4050d326e","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"az deployment sub create \\\n--name \"esml-cmn-$(dev_test_prod)-$(admin_locationSuffix)-$(aifactorySuffixRG)-DeplRG\" \\\n--subscription \"$(dev_test_prod_sub_id)\" \\\n--location \"$(admin_location)\" \\\n--template-file \"esml-common\\main\\11-rgCommon.bicep\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\11-esml-globals-11_13.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-1.json\" \\\n--parameters locationSuffix=\"$(admin_locationSuffix)\" \\\n--parameters location=\"$(admin_location)\" \\\n--parameters env=\"$(dev_test_prod)\" \\\n--parameters aifactorySuffixRG=\"$(aifactorySuffixRG)\" \\\n--parameters technicalAdminsObjectID=\"$(technical_admins_ad_object_id)\" \\\n--parameters technicalAdminsEmail=\"$(technical_admins_email)\"","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"$(System.DefaultWorkingDirectory)/_esml-aifactory/azure-enterprise-scale-ml/environment_setup/aifactory/bicep","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false","visibleAzLogin":"true","keepAzSessionActive":"false"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"12-Common-Networking","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"47b43cde-c003-4a0d-8ad1-40d4050d326e","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"az deployment sub create \\\n--name \"esml-cmn$(dev_test_prod)-$(aifactorySuffixRG)-$(aiResourceSuffix)Subnets\" \\\n--subscription \"$(dev_test_prod_sub_id)\" \\\n--location \"$(admin_location)\" \\\n--template-file \"esml-common\\main\\12-networkCommon.bicep\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-1.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-2-12_13_21_22.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-3-12_13.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-override.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\12-esml-cmn-parameters.json\" \\\n--parameters locationSuffix=\"$(admin_locationSuffix)\" \\\n--parameters location=\"$(admin_location)\" \\\n--parameters env=\"$(dev_test_prod)\" \\\n--parameters cidr_range=\"$(cidr_range)\" \\\n--parameters aifactorySuffixRG=\"$(aifactorySuffixRG)\" \\\n--parameters commonResourceSuffix=\"$(aiResourceSuffix)\" \\\n--parameters IPwhiteList=\"$(technical_admins_bastion_IP_whitelist)\"\n","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"$(System.DefaultWorkingDirectory)/_esml-aifactory/azure-enterprise-scale-ml/environment_setup/aifactory/bicep","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false","visibleAzLogin":"true","keepAzSessionActive":"false"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"30_Sleep for 1 minute","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"write-host \"Waiting for subnets to fully register to subscription\"\nStart-Sleep 60","errorActionPreference":"stop","warningPreference":"default","informationPreference":"default","verbosePreference":"default","debugPreference":"default","progressPreference":"silentlyContinue","failOnStderr":"false","showWarnings":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":"","runScriptInSeparateScope":"false"}},{"environment":{},"taskId":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","version":"2.*","name":"31_Show input parameter","refName":"","enabled":false,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"script":"echo \"parameters\"\ntype \"..\\..\\..\\..\\aifactory\\parameters\\13-esml-cmn-parameters.json\"\necho \"$(dev_test_prod)\"","workingDirectory":"$(System.DefaultWorkingDirectory)/_esml-aifactory/azure-enterprise-scale-ml/environment_setup/aifactory/bicep","failOnStderr":"false"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"13-Deploy resources ","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"47b43cde-c003-4a0d-8ad1-40d4050d326e","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"az deployment sub create \\\n--name \"esml-cmn-$(dev_test_prod)-$(admin_locationSuffix)-$(aifactorySuffixRG)-$(aiResourceSuffix)-DeplRes\" \\\n--subscription \"$(dev_test_prod_sub_id)\" \\\n--location \"$(admin_location)\" \\\n--template-file \"esml-common\\main\\13-rgLevel.bicep\" \\\n--parameters adminPassword=\"$(date +%s | sha256sum | base64 | head -c 32 ; echo)\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-1.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-2-12_13_21_22.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-3-12_13.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-4-13_21_22.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-5-13_23.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\10-esml-globals-override.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\11-esml-globals-11_13.json\" \\\n--parameters @\"..\\..\\..\\..\\aifactory\\parameters\\13-esml-cmn-parameters.json\" \\\n--parameters locationSuffix=\"$(admin_locationSuffix)\" \\\n--parameters location=\"$(admin_location)\" \\\n--parameters env=\"$(dev_test_prod)\" \\\n--parameters aifactorySuffixRG=\"$(aifactorySuffixRG)\" \\\n--parameters resourceSuffix=\"$(aiResourceSuffix)\" \\\n--parameters technicalAdminsObjectID=\"$(technical_admins_ad_object_id)\" \\\n--parameters technicalAdminsEmail=\"$(technical_admins_email)\" \\\n--parameters IPwhiteList=\"$(technical_admins_bastion_IP_whitelist)\" \\\n--parameters inputKeyvaultSubscription=\"$(admin_input_keyvault_subscription)\" \\\n--parameters inputKeyvaultResourcegroup=\"$(admin_input_keyvault_rg)\" \\\n--parameters inputKeyvault=\"$(admin_input_keyvault_name)\"","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"$(System.DefaultWorkingDirectory)/_esml-aifactory/azure-enterprise-scale-ml/environment_setup/aifactory/bicep","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false","visibleAzLogin":"true","keepAzSessionActive":"false"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":0,"url":"https://vsrm.dev.azure.com/ESML_AI_Factory/07da37fe-9071-4440-9127-f52f859d3062/_apis/Release/releases/0","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{"BoardsEnvironmentType":{"$type":"System.String","$value":"unmapped"},"LinkBoardsWorkItems":{"$type":"System.String","$value":"False"}},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://vsrm.dev.azure.com/ESML_AI_Factory/_apis/public/Release/badge/07da37fe-9071-4440-9127-f52f859d3062/34/94"}],"artifacts":[{"sourceId":"07da37fe-9071-4440-9127-f52f859d3062:b3db2f04-55e4-4892-833e-0c119d24d587","type":"Git","alias":"_esml-aifactory","definitionReference":{"branches":{"id":"main","name":"main"},"checkoutNestedSubmodules":{"id":"True","name":"Any nested submodules within"},"checkoutSubmodules":{"id":"true","name":"true"},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionType":{"id":"latestFromBranchType","name":"Latest from the default branch"},"definition":{"id":"b3db2f04-55e4-4892-833e-0c119d24d587","name":"aifactory-infra-001"},"fetchDepth":{"id":"","name":""},"gitLfsSupport":{"id":"","name":""},"project":{"id":"07da37fe-9071-4440-9127-f52f859d3062","name":"ESML-MLOps"}},"isPrimary":true,"isRetained":false}],"triggers":[],"releaseNameFormat":"Release-$(rev:r)","tags":[],"properties":{"DefinitionCreationSource":{"$type":"System.String","$value":"ReleaseClone"},"IntegrateBoardsWorkItems":{"$type":"System.String","$value":"False"},"IntegrateJiraWorkItems":{"$type":"System.String","$value":"false"}},"id":34,"name":"infra-aifactory-common","path":"\\202408-esml-aifactory-001","projectReference":null,"url":"https://vsrm.dev.azure.com/ESML_AI_Factory/07da37fe-9071-4440-9127-f52f859d3062/_apis/Release/definitions/34","_links":{"self":{"href":"https://vsrm.dev.azure.com/ESML_AI_Factory/07da37fe-9071-4440-9127-f52f859d3062/_apis/Release/definitions/34"},"web":{"href":"https://dev.azure.com/ESML_AI_Factory/07da37fe-9071-4440-9127-f52f859d3062/_release?definitionId=34"}}}